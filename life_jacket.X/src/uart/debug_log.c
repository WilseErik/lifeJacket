// =============================================================================
// Include statements
// =============================================================================

#include "uart\debug_log.h"

#include <stdint.h>
#include <stdbool.h>
#include <string.h>
#include <stdio.h>

#include <xc.h>

#include "hal\uart.h"
#include "hal\clock.h"

// =============================================================================
// Private type definitions
// =============================================================================

// =============================================================================
// Global variables
// =============================================================================

// =============================================================================
// Private constants
// =============================================================================
#define LINE_BUFFER_SIZE (100)

// =============================================================================
// Private variables
// =============================================================================
static char line_buffer[LINE_BUFFER_SIZE];
static uint16_t line_number = 0;
static bool debug_log_enabled = true;

// =============================================================================
// Private function declarations
// =============================================================================

// =============================================================================
// Public function definitions
// =============================================================================

void debug_log_append_line(const char * line)
{
    if (debug_log_enabled)
    {
        sprintf(line_buffer,
            "[%u, %lu] %s\r\n",
            line_number++,
            clock_get_msec(),
            line);
    
        uart_write_string(line_buffer);
    }
}

void debug_log_enable(bool enable)
{
    debug_log_enabled = enable;
}

// =============================================================================
// Private function definitions
// =============================================================================
